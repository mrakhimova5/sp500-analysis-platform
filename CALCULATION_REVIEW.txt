📊 CALCULATION LOGIC REVIEW
===========================

Let me review each visualization's calculation logic:

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1️⃣ CATEGORY TRENDS (Line Chart)
================================

Purpose: Show absolute keyword counts over time

Calculation:
- Y-axis = Raw count of keywords in each category
- X-axis = Year (2020-2024)

Logic: ✅ CORRECT
- Shows actual mentions in 10-K
- Each line = one category
- No normalization - pure counts

Example:
  AI category: 50 mentions in 2020 → 75 in 2024
  Shows increasing trend

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

2️⃣ HEATMAP (Relative Importance)
==================================

Purpose: Show each category as % of total mentions per year

Current Calculation:
  normalized_df = df.div(df.sum(axis=0), axis=1)

This means:
  normalized_df[category][year] = df[category][year] / sum_of_all_categories_in_that_year

⚠️ ISSUE FOUND: This compares WITHIN each year, NOT across years

Example for 2020:
  AI: 50 mentions
  Cloud: 100 mentions
  Security: 50 mentions
  Total: 200 mentions

  Heatmap shows:
  AI: 50/200 = 0.25 (25%)
  Cloud: 100/200 = 0.50 (50%)
  Security: 50/200 = 0.25 (25%)

This is comparing 2020 AI vs 2020 Cloud (within-year comparison)
NOT comparing 2020 AI vs 2024 AI (across-year comparison)

Logic: ⚠️ QUESTIONABLE
- Good for: "What % of mentions did AI get in 2020?"
- NOT good for: "Did AI become more important over time?"
- Each column (year) sums to 100%

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

3️⃣ GROWTH CHART (Percentage Change)
====================================

Purpose: Show % change from 2020 to 2024

Calculation:
  growth_pct = ((end_val - start_val) / start_val * 100)

Example:
  AI: 50 in 2020 → 100 in 2024
  Growth = ((100 - 50) / 50) * 100 = 100%

Logic: ✅ CORRECT
- Standard percentage change formula
- Handles division by zero
- Shows growth/decline properly

Special Cases:
  - If start = 0, end > 0: Shows 100% (new category)
  - If start = 0, end = 0: Shows 0% (no change)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

4️⃣ TOP TERMS (Bar Charts)
==========================

Purpose: Show top 15 keywords for each year

Calculation:
- Aggregates all keywords across categories
- Sorts by count (highest first)
- Shows top 15

Logic: ✅ CORRECT
- Simple ranking by frequency
- Color-coded by category
- One chart per year

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🔍 DETAILED HEATMAP ISSUE
=========================

Current Code:
  normalized_df = df.div(df.sum(axis=0), axis=1)

What this does:
  - axis=0 means sum DOWN each column (year)
  - Divides each cell by its column sum
  - Result: Each column (year) sums to 1.0 (100%)

Interpretation:
  "In 2020, AI represented 25% of all keyword mentions"
  "In 2024, AI represented 30% of all keyword mentions"

This shows RELATIVE IMPORTANCE WITHIN each year.

⚠️ LIMITATION:
  - Can't tell if absolute mentions increased
  - AI could have 25% in both years but with different totals:
    • 2020: 25% of 200 = 50 mentions
    • 2024: 25% of 400 = 100 mentions
  - Heatmap would show same color (0.25) for both!

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ WHAT'S CORRECT:

1. Growth Chart: ✅ Proper percentage change formula
2. Trends Chart: ✅ Shows absolute counts
3. Top Terms: ✅ Correctly ranks keywords

⚠️ WHAT'S QUESTIONABLE:

Heatmap: Normalizes WITHIN each year
- Good for: "What % of focus did AI get in 2020?"
- Misleading for: "Did AI become more important over time?"

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💡 RECOMMENDATION:

The heatmap is technically correct for showing "relative 
importance within each year" but might be confusing.

Consider:
1. Keep as-is but update label to clarify
2. OR normalize across ALL years for better comparison

Current label: "Relative Focus (% of mentions)"
Better label: "% of Total Mentions This Year"

OR change calculation to show year-over-year comparison
